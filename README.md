## Jenkins

The [trg-terraform-build-aks](https://bitbucket.org/mavenwave/trg-terraform-build-aks/src/master/) module is implemented to create a private AKS cluster that is linked to the Private DNS zone. The Jenkins is installed on this private cluster using the [Jenkins Helm](https://github.com/jenkinsci/helm-charts/tree/main/charts/jenkins). Jenkins chart installs a Jenkins server which spawns agents on Kubernetes utilizing the Jenkins Kubernetes plugin.

The AcrPull role is assigned to the Service Principal so that the Jenkins jobs can pull and push the Docker images generated as output from the job build.

The Persistent volume is created separately and then attached to Jenkins. It can be retained even if Jenkins resource is destroyed and reattached when Jenkins is reinstalled.

Connect to the trg-dev-bastion-001 bastion VM to get username and password, and decode base64 to connect to Jenkins:
kubectl edit secrets jenkins-admin

## Requirements

| Name | Version |
|------|---------|
| terraform | >= 0.12 |
| azurerm | =2.10 |

## Providers

azurerm 
helm
kubernetes
random

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| aks\_info |  The values required to create AKS cluster and service principal. | object | no |
| container\_registry\_name | n/a | `string` | `"OptimizeInsightsACRDev"` | no |
| container\_registry\_resource\_group\_name | n/a | `string` | `"rg-aks-dev-001"` | no |
| jenkins-admin-user | n/a | `string` | `"admin"` | no |
| jenkins\_plugins | n/a | `list` |  | no |
| management\_vnet\_id | The ID of the Virtual Network that should be linked to the DNS Zone. | `string` | `"/subscriptions/63a4467b-b46e-4f35-b623-1e5b076ef28c/resourceGroups/rg-internalnetwork-dev-001/providers/Microsoft.Network/virtualNetworks/vnet-dev-internal-mgmt-centralus-001"` | no |
| pvc | n/a | `string` | `"azure-managed-disk"` | no |
| storageclass | n/a | `string` | `"managed-premium-retain"` | no |

## Outputs

| Name | Description |
|------|-------------|
| client\_certificate | Base64 encoded public certificate used by clients to authenticate to the Kubernetes cluster |
| client\_key | Raw Kubernetes config to be used by kubectl |
| cluster\_ca\_certificate | Base64 encoded public CA certificate used as the root of trust for the Kubernetes cluster. |
| cluster\_password | A password or token used to authenticate to the Kubernetes cluster. |
| cluster\_username | A username used to authenticate to the Kubernetes cluster. |
| host | The Kubernetes cluster server host. |
| jenkins-password | n/a |
| jenkins-user | n/a |
| jenkins\_cluster\_id | The Kubernetes Managed Cluster ID |
| kube\_config | Kubernetes config |
| kube\_config\_raw | Raw Kubernetes config to be used by kubectl |
| managed\_rg\_name | Resource Group name managed by Microsoft when creating the cluster |
| private\_dns\_zone\_id | The ID of the Private DNS Zone Virtual Network Link |
| private\_dns\_zone\_name | Zone Name for the Private DNS Zone generated by private AKS |
| private\_fqdn | The Kubernetes Managed Cluster ID |
| sp\_object\_id | The Service Principal Object ID |